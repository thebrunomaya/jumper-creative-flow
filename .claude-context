# Claude Code Context File
# Auto-managed by Claude Code sessions
# Tracks recent decisions and work-in-progress (last 7 days)
# Older decisions migrate to docs/ARCHITECTURE.md

last_updated: "2026-01-22T21:00:00Z"
session_computer: "MacBook Pro"
session_user: "Bruno Maya"

# Recent decisions (last 7 days)
recent_decisions:
  - date: "2026-01-22"
    decision: "Account & Manager Management Interfaces (Fases 1-3)"
    status: "complete"
    details: |
      ## SESSAO 2026-01-22: GESTAO DE CONTAS COM SYNC NOTION

      ### Fase 1: Edge Function j_hub_account_update
      - Recebe dados do frontend, faz PATCH no Notion, atualiza Supabase
      - Suporta 17 campos editaveis
      - Permissoes: Admin (todas), Staff (suas contas)

      ### Fase 2: Interface /admin/accounts
      - AccountManagement.tsx - Lista com busca e filtros (Status, Tier)
      - AccountForm.tsx - Formulario com 5 abas
      - useAccountUpdate.ts - Hook para chamada da edge function

      ### Fase 3: Interface /admin/managers
      - j_hub_manager_update - Edge Function para gerentes
      - ManagerManagement.tsx - Lista com busca
      - ManagerForm.tsx - Formulario de edicao
      - useMyManagers.ts - Hook para buscar gerentes
      - useManagerUpdate.ts - Hook para atualizar

      ### Bugs Corrigidos
      - FIX: refetch() faltando em useMyNotionAccounts
      - FIX: Campos nao retornados por j_hub_user_accounts (id_google_analytics, etc)
      - EDGE: j_hub_user_accounts atualizado com todos os campos editaveis

    impact: "MAJOR - Interface de gestao com sync bidirecional Notion"
    files_changed:
      - "supabase/functions/j_hub_account_update/index.ts"
      - "supabase/functions/j_hub_manager_update/index.ts"
      - "supabase/functions/j_hub_user_accounts/index.ts"
      - "src/pages/admin/AccountManagement.tsx"
      - "src/pages/admin/ManagerManagement.tsx"
      - "src/components/admin/AccountForm.tsx"
      - "src/components/admin/ManagerForm.tsx"
      - "src/hooks/useAccountUpdate.ts"
      - "src/hooks/useManagerUpdate.ts"
      - "src/hooks/useMyManagers.ts"
      - "src/hooks/useMyNotionAccounts.ts"
      - "src/components/UserMenu.tsx"
      - "src/App.tsx"
    deployed: true
    deployment_status: "Edge functions deployed, frontend pushed"
    commits:
      - "c9550c4: feat: Account and Manager Management interfaces with Notion sync"
      - "1b03b8f: fix: Add refetch function to useMyNotionAccounts hook"
      - "0e661e8: fix: Return all editable fields from j_hub_user_accounts"

  - date: "2026-01-21"
    decision: "Dashboards Integrados V2 - Cross-Platform Analytics"
    status: "complete"
    details: |
      Views SQL criadas para Meta + GA4
      Dashboards V2 em /dashboards-v2
      GeneralDashboard com seletor de fonte
    impact: "MAJOR - Nova arquitetura de dashboards cross-platform"
    deployed: true

# Current issues being worked on
current_issues: []

# Work in progress
work_in_progress:
  - task: "Validacao Gestao de Contas (Fase 4)"
    status: "pending"
    next_step: "Testar com gestores reais e coletar feedback"

# Context for next session
next_session_context: |
  ## SESSAO ANTERIOR: GESTAO DE CONTAS COMPLETA (Fases 1-3)

  ### O QUE FOI FEITO:
  - Interface /admin/accounts para editar contas
  - Interface /admin/managers para editar gerentes
  - Sync bidirecional Flow -> Notion + Supabase
  - Bugs de refetch e campos corrigidos

  ### PROXIMOS PASSOS:
  1. Fase 4: Validacao com equipe real
  2. Fase 5 (futuro): Remover sync Notion, Supabase = source of truth

  ### ARQUITETURA:
  Flow edita -> j_hub_account_update -> PATCH Notion -> UPDATE Supabase
  Sync Notion -> le do Notion -> upsert Supabase (nao quebra)

  ### ROTAS CRIADAS:
  - /admin/accounts (admin/staff)
  - /admin/managers (admin only)

# TODOs pending
pending_todos:
  - "Fase 4: Validar Gestao de Contas com equipe"
  - "Fase 5: Remover sync Notion (futuro)"

# Deployment status
deployment:
  production_url: "https://flow.jumper.studio"
  current_version: "v2.1.118"
  last_deploy: "2026-01-22T21:00:00Z"
  last_deploy_status: "Account & Manager Management deployed"
  database_status: "STABLE"
  known_issues: "Nenhum"
