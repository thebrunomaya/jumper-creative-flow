# Claude Code Context File
# Auto-managed by Claude Code sessions
# Tracks recent decisions and work-in-progress (last 7 days)
# Older decisions migrate to docs/ARCHITECTURE.md

last_updated: "2026-01-23T00:30:00Z"
session_computer: "MacBook Pro"
session_user: "Bruno Maya"

# Recent decisions (last 7 days)
recent_decisions:
  - date: "2026-01-22"
    decision: "Dashboard Unificado Multi-Platform (Meta + Google Ads + GA4)"
    status: "complete"
    details: |
      ## SESSAO 2026-01-22: DASHBOARD UNIFICADO COM GOOGLE ADS + GA4

      ### Problema Inicial:
      - GeneralDashboard nao puxava metricas Google Ads nem GA4
      - IDs (id_google_ads, id_google_analytics) nao passavam pelo data chain

      ### Correcoes:
      1. **Data Chain Fix**: Adicionado id_google_ads e id_google_analytics em:
         - src/types/creative.ts (Client interface)
         - src/hooks/useNotionData.ts (useNotionClients hook)
         - src/components/dashboards/DashboardAccessControl.tsx
         - src/components/dashboards/DashboardsDisplay.tsx

      2. **RLS Policies**: Criada migration para tabelas Windsor.ai
         - j_rep_googleads_bronze - SELECT para authenticated
         - j_rep_ga4_bronze - SELECT para authenticated

      3. **GA4 Query Fix**: fetchGA4Data usava metaAdsId ao inves de id_google_analytics

      ### IDs da Conta Boiler (exemplo):
      - Meta Ads: 4167919386824961
      - Google Ads: 701-905-2125
      - GA4 Property: 291741002

      ### Auditoria GA4:
      - GA4 registra multiplos eventos como conversao (~3.3 por sessao)
      - event_value inflacionado (todos os eventos, nao apenas purchases)
      - Sessoes incluem todas as fontes (pago + organico + direto)
      - ROAS calculado incorretamente (precisa filtrar event_name='purchase')

      ### Melhorias Futuras (documentadas no Notion do usuario):
      - Filtrar apenas purchases para ROAS real
      - Toggle trafego pago vs todas as fontes
      - Breakdown por source/medium
      - Comparativo de periodos

    impact: "MAJOR - Dashboard unificado com dados de 3 plataformas"
    files_changed:
      - "src/types/creative.ts"
      - "src/hooks/useNotionData.ts"
      - "src/components/dashboards/DashboardAccessControl.tsx"
      - "src/components/dashboards/DashboardsDisplay.tsx"
      - "src/components/dashboards/GeneralDashboard.tsx"
      - "supabase/migrations/20260122235000_add_rls_to_google_bronze_tables.sql"
    deployed: true
    deployment_status: "Migration applied, frontend pushed"

  - date: "2026-01-22"
    decision: "Account & Manager Management Interfaces (Fases 1-3)"
    status: "complete"
    details: |
      Interface de gestao com sync bidirecional Notion
    impact: "MAJOR"
    deployed: true

  - date: "2026-01-21"
    decision: "Dashboards Integrados V2 - Cross-Platform Analytics"
    status: "complete"
    details: |
      Views SQL criadas para Meta + GA4
      Dashboards V2 em /dashboards-v2
      GeneralDashboard com seletor de fonte
    impact: "MAJOR - Nova arquitetura de dashboards cross-platform"
    deployed: true

# Current issues being worked on
current_issues: []

# Work in progress
work_in_progress:
  - task: "Melhorias Dashboard Unificado"
    status: "backlog"
    next_step: "Implementar filtro de purchases para ROAS real"

# Context for next session
next_session_context: |
  ## SESSAO ANTERIOR: DASHBOARD UNIFICADO MULTI-PLATFORM

  ### O QUE FOI FEITO:
  - Fix data chain para passar id_google_ads e id_google_analytics
  - RLS policies para j_rep_googleads_bronze e j_rep_ga4_bronze
  - Fix fetchGA4Data para usar id correto
  - Auditoria de dados GA4 (multiplas conversoes por sessao)

  ### MELHORIAS DOCUMENTADAS (usuario copiou pro Notion):
  1. Filtrar apenas event_name='purchase' para ROAS real
  2. Toggle trafego pago vs todas as fontes
  3. Breakdown por source/medium
  4. Comparativo de periodos
  5. Metricas de engajamento (bounce rate, tempo pagina)

  ### ARQUITETURA ATUAL:
  GeneralDashboard recebe via props:
  - accountInfo.metaAdsId -> j_rep_metaads_bronze
  - accountInfo.id_google_ads -> j_rep_googleads_bronze
  - accountInfo.id_google_analytics -> j_rep_ga4_bronze

# TODOs pending
pending_todos:
  - "Implementar filtro purchases para ROAS real"
  - "Toggle trafego pago"
  - "Fase 4: Validar Gestao de Contas com equipe"

# Deployment status
deployment:
  production_url: "https://flow.jumper.studio"
  current_version: "v2.1.120"
  last_deploy: "2026-01-23T00:30:00Z"
  last_deploy_status: "Dashboard Multi-Platform fixes deployed"
  database_status: "STABLE"
  known_issues: "GA4 ROAS inflacionado (precisa filtrar purchases)"
