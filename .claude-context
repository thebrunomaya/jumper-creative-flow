# Claude Code Context File
# Auto-managed by Claude Code sessions
# Tracks recent decisions and work-in-progress (last 7 days)
# Older decisions migrate to docs/ARCHITECTURE.md

last_updated: "2026-01-22T02:30:00Z"
session_computer: "MacBook Pro"
session_user: "Bruno Maya"

# Recent decisions (last 7 days)
recent_decisions:
  - date: "2026-01-21"
    decision: "Dashboards Integrados V2 - Cross-Platform Analytics"
    status: "in_progress"
    details: |
      ## SESSAO 2026-01-21: DASHBOARDS INTEGRADOS

      ### 1. Views SQL Criadas (Supabase)
      - v_meta_ga4_campaign_funnel - Funil Meta + GA4 por campanha
      - v_meta_ga4_adset_funnel - Funil por adset
      - v_meta_ga4_daily_performance - Performance diaria
      - v_conversion_discrepancy - Discrepancia de conversoes

      ### 2. Dashboards V2 (/dashboards-v2)
      Criados arquivos:
      - src/hooks/useIntegratedFunnel.ts
      - src/hooks/useConversionDiscrepancy.ts
      - src/components/dashboards-v2/IntegratedFunnelDashboard.tsx
      - src/components/dashboards-v2/DiscrepancyDashboard.tsx
      - src/pages/DashboardsV2Page.tsx

      ### 3. GeneralDashboard Atualizado (/dashboards)
      Seletor de fonte: Unificado | Meta Ads | Google Ads

      ### 4. PROBLEMA PENDENTE: Mapeamento GA4
      GA4 nao tem account_id que corresponda ao Meta/Google.
      Sessoes e conversoes aparecem zeradas na visao unificada.
      VER: docs/dashboards-v2-report.md para detalhes

    impact: "MAJOR - Nova arquitetura de dashboards cross-platform"
    files_changed:
      - "src/components/dashboards/GeneralDashboard.tsx"
      - "src/components/dashboards-v2/*"
      - "src/hooks/useIntegratedFunnel.ts"
      - "src/hooks/useConversionDiscrepancy.ts"
      - "src/pages/DashboardsV2Page.tsx"
      - "supabase/migrations/20260121000000_create_bronze_views.sql"
    deployed: true
    deployment_status: "Deployed - GA4 mapping pending"
    commits:
      - "cade9a2: feat: Add integrated dashboards v2 with Meta + GA4 cross-platform analytics"
      - "322580c: feat: Add data source selector to GeneralDashboard"

  - date: "2026-01-21"
    decision: "AdChecker V2 Promotion & Cleanup"
    status: "complete"
    details: |
      MetaCheckerV2 promovido para /adchecker oficial
      Rotas de teste removidas
    impact: "MINOR - AdChecker com batch upload"
    deployed: true

# Current issues being worked on
current_issues:
  - issue: "GA4 data not mapping to accounts"
    severity: "HIGH"
    description: |
      GA4 table (j_rep_ga4_bronze) doesn't have an account_id that matches
      Meta Ads or Google Ads accounts. Need to investigate how Windsor.ai
      maps GA4 data and find the correct join strategy.
    see_doc: "docs/dashboards-v2-report.md"

# Work in progress
work_in_progress:
  - task: "Dashboards Integrados V2"
    status: "blocked"
    blocker: "GA4 account mapping"
    next_step: "Investigar estrutura do GA4 e como mapear para contas"

# Context for next session
next_session_context: |
  ## SESSAO ANTERIOR: DASHBOARDS INTEGRADOS (PARCIAL)

  ### PROBLEMA PRINCIPAL:
  A visao unificada mostra Sessoes = 0 porque o GA4 nao tem
  account_id que corresponda ao Meta Ads.

  ### PARA RESOLVER:
  1. Executar query de investigacao:
     SELECT DISTINCT account_id, source, medium FROM j_rep_ga4_bronze LIMIT 50;

  2. Verificar se existe campo ga4_property_id nas contas do Notion

  3. Entender como Windsor.ai mapeia os dados

  ### DOCUMENTO DE REFERENCIA:
  docs/dashboards-v2-report.md - Relatorio completo com problemas e proximos passos

  ### ROTAS CRIADAS:
  - /dashboards (GeneralDashboard atualizado com seletor)
  - /dashboards-v2 (novos dashboards integrados)

# TODOs pending
pending_todos:
  - "URGENTE: Resolver mapeamento GA4 <-> Contas"
  - "Google Ads: Verificar se contas tem id_google_ads configurado"
  - "Dashboards P2: Qualidade Trafego, Criativos, Cross-Channel"

# Deployment status
deployment:
  production_url: "https://flow.jumper.studio"
  current_version: "v2.1.115"
  last_deploy: "2026-01-22T02:00:00Z"
  last_deploy_status: "Dashboards V2 + GeneralDashboard source selector"
  database_status: "STABLE - Views criadas"
  known_issues: "GA4 data not mapping correctly in unified view"
