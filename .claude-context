# Claude Code Context File
# Auto-managed by Claude Code sessions
# Tracks recent decisions and work-in-progress (last 7 days)
# Older decisions migrate to docs/ARCHITECTURE.md

last_updated: "2026-01-23T22:00:00Z"
session_computer: "MacBook Pro"
session_user: "Bruno Maya"

# Recent decisions (last 7 days)
recent_decisions:
  - date: "2026-01-23"
    decision: "WooCommerce Integration + Daily Report System"
    status: "complete"
    details: |
      ## SESSAO 2026-01-23: WOOCOMMERCE + DAILY REPORTS

      ### WooCommerce Integration (20 commits):
      1. Criacao das tabelas j_rep_woocommerce_bronze e j_hub_woocommerce_sync_status
      2. Edge Function j_hub_woocommerce_sync com:
         - Backfill em chunks (14 dias/chunk) para evitar timeout
         - Multi-tenant support
         - Status suportados: completed, processing, enviado, shipped, delivered, entregue
      3. CRON job 4:00 BRT para sync diario
      4. UI: WooCommerceSyncControl component na aba Plataformas
      5. Campos: Woo Site URL, Consumer Key, Consumer Secret

      ### Daily Report System:
      1. Edge Function j_hub_daily_report com:
         - Agregacao WooCommerce + Meta Ads + Google Ads + GA4
         - Geracao de insights via Claude AI (Haiku)
         - Envio via Evolution API (WhatsApp)
      2. CRON job 8:00 BRT para disparo automatico
      3. Formato: 2 mensagens separadas (dados + insights)
      4. Top 3 produtos por faturamento
      5. Alertas configurÃ¡veis (ROAS, CPA, Conversao)
      6. UI: Aba "Relatorios" no AccountForm
      7. ReportDispatchControl com modo teste e override de numero

      ### Fixes durante implementacao:
      - line_item_id = 0 para order records, > 0 para line items
      - item_total para faturamento (nao quantity)
      - Google Ads column names (spend, conversions_value)
      - WooCommerce status filtering
      - Evolution API auth
      - Account update validation

    impact: "MAJOR - Sistema completo de e-commerce + relatorios automatizados"
    files_changed:
      - "supabase/migrations/20260123000000_create_woocommerce_tables.sql"
      - "supabase/functions/j_hub_woocommerce_sync/index.ts"
      - "supabase/functions/j_hub_daily_report/index.ts"
      - "src/components/admin/AccountForm.tsx"
      - "src/components/admin/WooCommerceSyncControl.tsx"
      - "src/components/admin/ReportDispatchControl.tsx"
    deployed: true
    deployment_status: "Frontend deployed, Edge Functions deployed"

  - date: "2026-01-22"
    decision: "Dashboard Unificado Multi-Platform (Meta + Google Ads + GA4)"
    status: "complete"
    details: |
      GeneralDashboard integra dados de 3 plataformas via data chain
    impact: "MAJOR"
    deployed: true

  - date: "2026-01-22"
    decision: "Account & Manager Management Interfaces (Fases 1-3)"
    status: "complete"
    details: |
      Interface de gestao com sync bidirecional Notion
    impact: "MAJOR"
    deployed: true

# Current issues being worked on
current_issues: []

# Work in progress
work_in_progress:
  - task: "Melhorias Dashboard Unificado"
    status: "backlog"
    next_step: "Implementar filtro de purchases para ROAS real"

# Context for next session
next_session_context: |
  ## SESSAO ANTERIOR: WOOCOMMERCE + DAILY REPORTS (2026-01-23)

  ### O QUE FOI FEITO (20 commits):
  - WooCommerce Integration completa (sync, backfill, UI)
  - Daily Report System com AI insights
  - Top 3 produtos por faturamento
  - Disparo manual com modo teste

  ### ARQUITETURA:
  - j_rep_woocommerce_bronze: pedidos + line items (line_item_id = 0 para pedido)
  - j_hub_daily_report: agrega WooCommerce + Meta + Google + GA4
  - Evolution API para WhatsApp
  - Claude Haiku para insights

  ### DOCUMENTACAO ATUALIZADA:
  - docs/ARCHITECTURE.md - Secoes WooCommerce e Daily Report
  - docs/ROADMAP.md - Status atualizado
  - CLAUDE.md - Versao v2.2.6

# TODOs pending
pending_todos:
  - "Filtrar purchases para ROAS real no GA4"
  - "Toggle trafego pago vs todas as fontes"
  - "Fase 4: Validar Gestao de Contas com equipe"

# Deployment status
deployment:
  production_url: "https://flow.jumper.studio"
  current_version: "v2.2.6"
  last_deploy: "2026-01-23T22:00:00Z"
  last_deploy_status: "WooCommerce + Daily Reports deployed"
  database_status: "STABLE"
  known_issues: "GA4 ROAS inflacionado (precisa filtrar purchases)"
