# Claude Code Context File
# Auto-managed by Claude Code sessions
# Tracks recent decisions and work-in-progress (last 7 days)
# Older decisions migrate to docs/ARCHITECTURE.md

last_updated: "2024-12-11T23:30:00Z"
session_computer: "MacBook Pro"
session_user: "Bruno Maya"

# Recent decisions (last 7 days)
# When older than 7 days, migrate to docs/ARCHITECTURE.md
recent_decisions:
  - date: "2024-12-11"
    decision: "Top 3 Criativos - Dashboard Feature + Windsor Query Update"
    status: "partially_complete ‚è≥"
    details: |
      üèÜ TOP 3 CRIATIVOS - NOVA SE√á√ÉO NOS DASHBOARDS

      ## Session Summary (2024-12-11):

      ### 1. Windsor Query Analysis

      **Compara√ß√£o de queries:**
      - Query atual: 38 campos
      - Query do gestor: 23 campos
      - Campos √∫teis do gestor: campaign_daily_budget, campaign_status, action_values_add_to_cart

      **Campos de criativo descobertos no Windsor:**
      - body (texto principal do an√∫ncio)
      - title (t√≠tulo/headline)
      - link (URL de destino)
      - thumbnail_url (thumbnail de v√≠deos)
      - media_type (IMAGE/VIDEO/CAROUSEL)

      ### 2. Implementa√ß√£o Completa

      **Arquivos criados:**
      - `src/utils/creativeRankingMetrics.ts` - M√©tricas por objetivo
      - `src/hooks/useTopCreatives.ts` - Hook de dados
      - `src/components/dashboards/TopCreativeCard.tsx` - Card individual
      - `src/components/dashboards/TopCreativesSection.tsx` - Container

      **Integra√ß√£o:**
      - SalesDashboard.tsx agora inclui TopCreativesSection
      - Mostra top 3 ads por ROAS

      ### 3. Database Migration

      **Campos adicionados via SQL direto:**
      ```sql
      ALTER TABLE j_rep_metaads_bronze
      ADD COLUMN IF NOT EXISTS body TEXT,
      ADD COLUMN IF NOT EXISTS title TEXT,
      ADD COLUMN IF NOT EXISTS link TEXT,
      ADD COLUMN IF NOT EXISTS thumbnail_url TEXT,
      ADD COLUMN IF NOT EXISTS media_type TEXT,
      ADD COLUMN IF NOT EXISTS campaign_daily_budget NUMERIC(12,2),
      ADD COLUMN IF NOT EXISTS campaign_status TEXT,
      ADD COLUMN IF NOT EXISTS action_values_add_to_cart NUMERIC(10,2) DEFAULT 0;
      ```

      ### 4. Problema Identificado: Imagens

      **Diagn√≥stico:**
      - Query SQL mostrou 4 de 5 ads com image_url: null
      - Windsor n√£o retorna image_url para todos os formatos
      - URLs da Meta expiram em 24-72h

      **Solu√ß√£o proposta (pr√≥xima sess√£o):**
      - Fase 1: Aguardar Windsor com query atualizada
      - Fase 2: Fallback inteligente no UI
      - Fase 3: Download para Supabase Storage
      - Fase 4: Rollout para outros dashboards

      ### 5. Documenta√ß√£o

      **Roadmap criado:**
      - `docs/ROADMAP-TOP-CRIATIVOS.md`
      - Plano completo em 4 fases
      - Checklist para pr√≥xima sess√£o
      - Decis√µes pendentes documentadas

    impact: "MAJOR - Nova feature Top Criativos + expans√£o da query Windsor"
    files_changed:
      - "src/utils/creativeRankingMetrics.ts (NEW)"
      - "src/hooks/useTopCreatives.ts (NEW)"
      - "src/components/dashboards/TopCreativeCard.tsx (NEW)"
      - "src/components/dashboards/TopCreativesSection.tsx (NEW)"
      - "src/components/dashboards/SalesDashboard.tsx (modified)"
      - "supabase/migrations/20251211224407_add_creative_fields_to_bronze.sql (NEW)"
      - "_tmp-bruno/windsor-query-atualizada.txt (query atualizada)"
      - "docs/ROADMAP-TOP-CRIATIVOS.md (NEW - roadmap)"
    deployed: true
    deployment_status: "Deployed via git push ‚úÖ (v2.1.82)"
    commits:
      - "dd0b0b0: feat(dashboards): Add Top 3 Criativos section to SalesDashboard (v2.1.82)"
      - "55f6a58: docs: Add Top Criativos roadmap for image/video handling (v2.1.83)"
    migrate_to_architecture: false

# Current issues being worked on
current_issues:
  - issue: "Imagens n√£o aparecem para maioria dos ads"
    status: "diagnosed"
    details: "Windsor n√£o retorna image_url para todos formatos. Solu√ß√£o: Storage + fallback"
    priority: "medium"
    next_action: "Aguardar Windsor rodar com query atualizada, depois implementar fallback"

# Work in progress
work_in_progress:
  - feature: "Top 3 Criativos"
    status: "partial"
    completed:
      - "‚úÖ Componentes criados"
      - "‚úÖ Hook implementado"
      - "‚úÖ Integrado no SalesDashboard"
      - "‚úÖ Migration aplicada"
      - "‚úÖ Query Windsor atualizada (arquivo txt)"
    pending:
      - "‚è≥ Windsor rodar com novos campos"
      - "‚è≥ Implementar fallback de imagens"
      - "‚è≥ Implementar Storage para persist√™ncia"
      - "‚è≥ Rollout para outros 11 dashboards"

# Context for next session
next_session_context: |
  üéØ SESSION 2024-12-11 COMPLETED: TOP 3 CRIATIVOS

  ## ‚úÖ O QUE FOI FEITO HOJE:

  **Feature Top Criativos:**
  - ‚úÖ Componentes criados (TopCreativeCard, TopCreativesSection)
  - ‚úÖ Hook useTopCreatives com l√≥gica de ranking por objetivo
  - ‚úÖ Integrado no SalesDashboard (mostrando ROAS 33x, 32x, 26x)
  - ‚úÖ Deploy em produ√ß√£o (v2.1.82)

  **Database:**
  - ‚úÖ 8 novos campos adicionados via SQL direto
  - ‚úÖ body, title, link, thumbnail_url, media_type
  - ‚úÖ campaign_daily_budget, campaign_status, action_values_add_to_cart

  **Query Windsor:**
  - ‚úÖ Query atualizada salva em: `_tmp-bruno/windsor-query-atualizada.txt`
  - ‚ö†Ô∏è A√á√ÉO MANUAL NECESS√ÅRIA: Atualizar query no Windsor.ai dashboard

  ## ‚ö†Ô∏è PROBLEMA IDENTIFICADO:

  **Imagens n√£o aparecem:**
  - 4 de 5 ads t√™m image_url: null
  - Windsor n√£o retorna image_url para v√≠deos/carross√©is
  - URLs da Meta expiram em 24-72h

  **Roadmap de solu√ß√£o:** `docs/ROADMAP-TOP-CRIATIVOS.md`

  ## üìã PR√ìXIMA SESS√ÉO - CHECKLIST:

  1. Verificar se Windsor rodou com query atualizada:
     ```sql
     SELECT COUNT(*) FROM j_rep_metaads_bronze WHERE thumbnail_url IS NOT NULL;
     ```

  2. Se dados novos dispon√≠veis:
     - Implementar Fase 2 (fallback inteligente)
     - Testar cobertura de imagens

  3. Se dados ainda n√£o dispon√≠veis:
     - Verificar configura√ß√£o Windsor
     - Implementar fallback como mitiga√ß√£o

  4. Depois: Rollout para outros 11 dashboards

  ## üìÅ ARQUIVOS IMPORTANTES:

  - Query Windsor: `_tmp-bruno/windsor-query-atualizada.txt`
  - Roadmap completo: `docs/ROADMAP-TOP-CRIATIVOS.md`
  - Componentes: `src/components/dashboards/TopCreative*.tsx`
  - Hook: `src/hooks/useTopCreatives.ts`

# TODOs pending
pending_todos:
  - "Atualizar query no Windsor.ai dashboard (A√á√ÉO MANUAL)"
  - "Verificar se Windsor populou novos campos"
  - "Implementar fallback de imagens"
  - "Implementar Supabase Storage para imagens persistentes"
  - "Rollout TopCreativesSection para outros dashboards"

# Recently completed (for reference)
completed_recently:
  - "‚úÖ [2024-12-11 23:14] Top Criativos funcionando em produ√ß√£o (ROAS aparecendo)"
  - "‚úÖ [2024-12-11 22:50] Deploy v2.1.82 para produ√ß√£o"
  - "‚úÖ [2024-12-11 22:45] Migration aplicada via SQL direto"
  - "‚úÖ [2024-12-11 22:30] Query Windsor atualizada com novos campos"
  - "‚úÖ [2024-12-11 22:00] Implementa√ß√£o completa dos componentes"
  - "‚úÖ [2024-12-11 21:30] Plano aprovado para Top 3 Criativos"

# Deployment status
deployment:
  production_url: "https://hub.jumper.studio"
  current_version: "v2.1.82"
  last_deploy: "2024-12-11T23:00:00Z"
  last_deploy_status: "Top 3 Criativos deployed ‚úÖ"
  last_commit: "55f6a58 - docs: Add Top Criativos roadmap"
  database_status: "STABLE - 8 novos campos adicionados ‚úÖ"
  known_issues: "Imagens n√£o aparecem para todos os ads (aguardando Windsor)"
  recent_commits:
    - "55f6a58: docs: Add Top Criativos roadmap for image/video handling (v2.1.83)"
    - "dd0b0b0: feat(dashboards): Add Top 3 Criativos section to SalesDashboard (v2.1.82)"
    - "d200e2b: fix(dashboards): Date range picker now correctly applies selected dates (v2.1.80)"

# Notes for context rotation
context_rotation:
  last_rotation: "2024-12-11"
  next_rotation: "2024-12-18"
  items_ready_to_migrate:
    - "Decks System CSS extraction (2024-11-16) - migrate to ARCHITECTURE.md"
