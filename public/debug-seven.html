<!DOCTYPE html>
<html>
<head>
    <title>Debug Cl√≠nica Seven Data</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        pre { background: #000; padding: 10px; border: 1px solid #0f0; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; cursor: pointer; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîç Debug Cl√≠nica Seven Data</h1>
    <button onclick="checkData()">Investigar Dados</button>
    <pre id="output">Clique no bot√£o para investigar...</pre>

    <script>
        const SUPABASE_URL = 'https://biwwowendjuzvpttyrlb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpd3dvd2VuZGp1enZwdHR5cmxiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM4MjM1MzAsImV4cCI6MjAzOTM5OTUzMH0.aHlWkiUz8e9L6wfxuXB0PoiY7zNNjz7lmgpJfJMqF44';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function checkData() {
            const output = document.getElementById('output');
            const targetAccountId = '965811332434181';
            let result = '';

            try {
                result += 'üîç Investigando Cl√≠nica Seven...\n\n';

                // 1. Check distinct account_ids
                const { data: allData } = await supabase
                    .from('j_rep_metaads_bronze')
                    .select('account_id')
                    .limit(1000);

                const uniqueIds = [...new Set(allData?.map(a => a.account_id) || [])];
                result += `üìã Total de Account IDs √∫nicos: ${uniqueIds.length}\n`;
                result += `Sample: ${uniqueIds.slice(0, 10).join(', ')}\n\n`;

                // 2. Check exact match
                const { data: exactData, count: exactCount } = await supabase
                    .from('j_rep_metaads_bronze')
                    .select('*', { count: 'exact' })
                    .eq('account_id', targetAccountId)
                    .limit(5);

                result += `‚úÖ Registros com account_id = "${targetAccountId}": ${exactCount || 0}\n`;
                if (exactData && exactData.length > 0) {
                    result += `Sample data:\n${JSON.stringify(exactData[0], null, 2)}\n\n`;
                }

                // 3. Check if ID exists with different format (as number)
                const { count: numCount } = await supabase
                    .from('j_rep_metaads_bronze')
                    .select('*', { count: 'exact', head: true })
                    .eq('account_id', parseInt(targetAccountId));

                result += `üî¢ Registros com account_id (como n√∫mero): ${numCount || 0}\n\n`;

                // 4. Check date range
                const { data: latestDate } = await supabase
                    .from('j_rep_metaads_bronze')
                    .select('date')
                    .order('date', { ascending: false })
                    .limit(1);

                result += `üìÖ Data mais recente na tabela: ${latestDate?.[0]?.date || 'N/A'}\n\n`;

                // 5. Check recent data for this account
                const { data: recentData, count: recentCount } = await supabase
                    .from('j_rep_metaads_bronze')
                    .select('date, account_id, spend', { count: 'exact' })
                    .eq('account_id', targetAccountId)
                    .gte('date', '2025-09-28')
                    .order('date', { ascending: false });

                result += `üìä Registros √∫ltimos 7 dias (desde 28/09): ${recentCount || 0}\n`;
                if (recentData && recentData.length > 0) {
                    result += `Datas encontradas: ${recentData.map(r => r.date).join(', ')}\n`;
                }

                output.textContent = result;

            } catch (error) {
                output.textContent = `‚ùå Erro: ${error.message}\n${error.stack}`;
            }
        }
    </script>
</body>
</html>
